{% extends 'new_base.html' %}

{% block content %}

    <style>
    #small-button {
        margin-top: 2%;
        margin-right: 2%;
        width: 45%;
        height: 5%;
        font-size: 100%;
        padding: 0;
        padding-left: 1%;
        padding-right: 3%;
    }
    #long-button {
        margin-top: 2%;
    }
    #save-button {
        font-size: 150%;
        width: 30%;
    }
    </style>

    {% if active_session %}
        <div class="row">
        {% if coach %}
        <div class="col s4" align="center">
        <a class="btn waves-effect waves-light black modal-trigger" id="small-button" href="#new-session-modal">Add a Session<i class="material-icons right">add</i></a>
        </div>
            {% else %}
             <div class="col s4" align="center">&nbsp;&nbsp;
        </div>
        {% endif %}

            <div class="col s4">
    <div align="center"><h5>{{ session.date }} Session</h5></div>
            </div>
         <div class="col s4" align="center">
             <a class="btn waves-effect waves-light blue modal-trigger" id="small-button" href="#change-session-modal">View Other Session<i class="material-icons right">view</i></a>
             <a class="btn waves-effect waves-light black modal-trigger yellow darken-2 btn-small"  id="small-button" href="/student/{{ student.username }}/all_sessions">View All Sessions<i class="material-icons right">bubble_chart</i></a>

         </div>
        </div>

        <br>
<div class="row">
    <form action="/student/{{ student.username }}/save_session/{{ session.id }}" method="post" onsubmit="setFormSubmitting()" id="sessionform">
        {% csrf_token %}
        <div class="input-field col s12 m6 l6">
          <textarea id="celebrations" class="materialize-textarea" name="celebrations" value="hi"></textarea>
          <label for="celebrations">Successes</label>
        </div>
          <div class="input-field col s12 m6 l6">
          <textarea id="missing_work" class="materialize-textarea" name="missing_work"></textarea>
          <label for="missing_work">Missing Work</label>
        </div>

        <div class="input-field col s12 m6 l6">
          <textarea id="questions" class="materialize-textarea" name="questions"></textarea>
          <label for="questions">Topics to Discuss</label>
         </div>
            <div class="input-field col s12 m6 l6">
          <textarea id="due_dates" class="materialize-textarea" name="due_dates"></textarea>
          <label for="due_dates">Upcoming Due Dates</label>
        </div>



        <div class="input-field col s12 m6 l6">
          <textarea id="follow_up" class="materialize-textarea" name="follow_up"></textarea>
          <label for="follow_up">Coach's Next Steps</label>
        </div>
            <div class="input-field col s12 m6 l6">
          <textarea id="commitments" class="materialize-textarea" name="commitments"></textarea>
          <label for="commitments">Student's Next Steps</label>
        </div>



        <div class="input-field col s12 m12 l12">
          <textarea id="notes" class="materialize-textarea" name="notes"></textarea>
          <label for="notes">Additional Notes</label>
        </div>
        {% if coach %}
        <div align="center">
        <button class="btn waves-effect waves-light green lighten-1" id="save-button" type="submit" name="action">SAVE
                        <i class="material-icons right">save</i>
        </button>
       </div>
        {% endif %}
    </form>
  </div>
        {% else %}
        <br><br><br>
        <div align="center"><div class="flow-text grey-text">There are currently no sessions for {{ student.name }}.</div></div>
        {% if coach %}
        <div align="center">
            <a class="btn waves-effect waves-light black modal-trigger " href="#new-session-modal">Add Session<i class="material-icons right">add</i></a>
        </div>
            {% endif %}
    {% endif %}




    <div id="new-session-modal" class="modal">
        <div class="modal-content">
            <h4 class="center-align">Create a New Session</h4>
                <form method="post" action="/student/{{ student.username }}/session/{{ session_number }}">
                    {% csrf_token %}
                     <div class="col s4 offset-s4">
                        <b>Date of Session:</b><input class="input-field" type="date" name="new_session_date" required>
                     </div>
                    <a href="#" class="modal-close waves-effect waves-green btn-flat black white-text">Close</a>
                    <button class="btn waves-effect waves-light red right" type="submit" name="action">Create
                        <i class="material-icons right">add</i>
                    </button>

                </form>

        </div>


    </div>

    <div id="change-session-modal" class="modal">
        <div class="modal-content">
            <h5 class="center-align">View or Edit a Previous Session</h5>
            {% for option in sessions %}
                <div align="center">
            <a class="btn waves-effect waves-light white black-text modal-trigger" id="long-button" href="/student/{{ student.username }}/session/{{ forloop.counter }}">Session {{ forloop.counter }} - {{ option.date }}</a>
            </div>
            {% endfor %}
        <br>
        </div>


    </div>

    <script>

        var celeb = {{ session.celebrations }};
        celeb.replace('&#39;', '\'');
        $('#celebrations').val(celeb);
        alert(celeb);
        $('#missing_work').val('{{ session.missing_work }}');
        $('#questions').val('{{ session.questions_about_session }}');
        $('#due_dates').val('{{ session.upcoming_due_dates }}');
        $('#follow_up').val('{{ session.coach_follow_up }}');
        $('#commitments').val('{{ session.student_commitments }}');
        $('#notes').val('{{ session.notes }}');


        $(document).ready(function(){
    // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
    $('.modal-trigger').leanModal();
  });
        {% comment %}
       var formSubmitting = false;

var setFormSubmitting = function() { formSubmitting = true; };

window.onload = function() {
    window.addEventListener("beforeunload", function (e) {
            var saving = {{ save }};
            if (saving>0.1) {
                document.getElementById("sessionform").submit();
            }
            alert(saving);
        var confirmationMessage = 'It looks like you have been editing something. '
                                + 'If you leave before saving, your changes will be lost.';

        (e || window.event).returnValue = confirmationMessage; //Gecko + IE
        return confirmationMessage; //Gecko + Webkit, Safari, Chrome etc.


    });


};
{% endcomment %}

    </script>

{% endblock %}